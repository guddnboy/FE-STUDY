# CORS(Cross-Origin Resource Sharing)가 무엇인가요?

**CORS**는 **서로 다른 출처에서 제공되는 자원(resouce)에 접근할 수 있도록 허용하는 정책**입니다. 기본적으로 브라우저에는 동일 출처 정책(Same-Origin Policy)이 적용되어 있습니다. 해당 자원이 같은 출처에서 제공하는 것이 아니라면 브라우저는 이를 차단합니다. 이 정책 덕분에 보안이 강화되지만, 합법적인 요청도 차단을 하는 문제가 발생합니다. 이를 해결하기 위해 CORS가 개발되었습니다.

## CORS를 적용하는 방법은 무엇인가요?

서버 측에서 **Access-Control-Allow-Origin** 헤더를 설정하면, 특정 출처에서의 접근을 허용할 수 있습니다. 예를 들어, `Access-Control-Allow-Origin: *`로 모든 출처에 대해 허용하거나 특정 출처만 선택적으로 허용할 수 있습니다. 추가로, `Access-Control-Allow-Methods`와 `Access-Control-Allow-Headers` 헤더를 통해 **HTTP 메소드나 특정 헤더를 허용**할 수도 있습니다. 이는 서버에서 수행되는 동작이므로, **프론트엔드 개발자는 일반적으로 서버 개발자에게 클라이언트의 도메인을 허용하도록 요청해야 합니다.**

## 그렇다면 동일 출처 정책은 어떤 공격을 막기 위해 존재하는 것인가요?

> 크로스사이트 요청 위조(CSRF) 공격을 막기 위해 존재합니다.

### 크로스사이트 요청 위조(CSRF)란 무엇인가요?

악성 웹사이트가 **사용자의 요청을 도용**하여, 의도치 않은 요청을 서버에 보내게 만드는 공격입니다. 예를 들어, 피해자가 사이트에 접근하였을 때 해당 사용자의 요청인 것처럼 GET 요청을 보내 사용자의 개인정보를 탈취할 수 있습니다. 동일 출처 정책은 이러한 공격을 막기 위해 존재합니다.

> 동일 출처 정책이 크로스사이트 요청 위조를 완전히 막지는 못하지만, 다른 출처 간의 데이터 접근을 제한함으로써 **클라이언트 측 보안을 강화**하는 중요한 역할을 합니다.

# 관련된 경험이나 추가로 학습한 내용

## CORS를 겪었던 경험이 있나요?

프론트엔드 작업 중 회원가입 API를 요청을 했는데, CORS가 떠서 당황했던 경험이 있었습니다. 요청을 한 출처가 달라서 발생하는 것으로, 프론트엔드 측에서도 처리가 가능하다고는 들었지만 주로 서버 측에서 처리한다는 것을 알게 되었습니다. 이후 회원가입에서 발급받은 JWT(Json Web Token)을 이용하여 로그인 기능을 처리했습니다.

## 생성된 토큰 관리는 어떻게 하나요?

토큰을 저장하는 방법은 두 가지가 있습니다. 두 가지 방법 다 **XSS 공격에 위험**합니다.

### LocalStorage 사용

CSRF 공격에는 안전

> 자동으로 request에 담기는 쿠키와 다르게 **js 코드에 의해 헤더에 담기므로**, XSS를 뚫지 않는 이상 공격자가 정상적인 사용자인 척 request를 보내기가 쉽지 않습니다.

XSS 공격에는 취약

> 공격자가 localStorage에 접근하는 js 코드를 주입하면 쉽게 접근할 수 있습니다.

### Cookie 사용

XSS 공격으로부터 localStorage에 비해 안전

> 쿠키의 `httpOnly` 옵션을 사용하면 js에서 쿠키에 접근 자체가 불가능합니다. 하지만 js로 request를 보낼 수 있으므로 자동으로 request에 실리는 쿠키의 특성 상 요청을 위조할 수 있습니다.

CSRF 공격에 취약

> 공격자가 request url만 안다면 사용자가 관련 link를 클릭하도록 유도하여 request를 위조하기 쉽습니다. 최근에는 쿠키의 same-site 속성과 js의 fetch api 속성의 기본값 등으로 `request에 쿠키를 싣지 않음`이 설정되어 있습니다.

## XSS(Cross Site Scripting)은 무엇인가요?

공격자가 의도하는 악의적인 JavaScript 코드를 피해자 웹 브라우저에 실행시키는 공격입니다. `Code Injection Attack`이라고도 합니다.

1. 공격자는 XSS에 취약한 페이지에 공격을 수행함으로써 **사용자의 쿠키 정보나 세션 ID를 획득**할 수 있습니다.
2. 취약점에 대한 공격 코드가 실행되도록 하여 **사용자의 시스템을 통제**할 수 있습니다.
3. XSS 공격은 악성 스크립트 자체로 악성 프로그램을 다운로드 할 수는 없습니다. 하지만, **악성 스크립트가 있는 URL을 클릭하도록 유도해 다운로드 받는 사이트로 Redirect하거나 트로이 목마 프로그램을 다운로드 하도록 유도**할 수 있습니다.
4. `<script>` 태그 뿐만 아니라 `<img>` 태그 등을 사용해 원래 페이지와는 관련없는 페이지를 표시할 수 있습니다.
