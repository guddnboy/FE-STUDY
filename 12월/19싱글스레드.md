# 자바스크립트는 싱글 스레드 언어인데, 어떻게 동시에 여러 작업들을 수행하나요?

## 자바스크립트는 싱글 스레드 언어입니다.

자바스크립트는 싱글 스레드 언어이기 때문에 함수 호출이 스택에 순차적으로 쌓이고, 스택의 맨 위에서부터 차례대로 한 번에 하나의 함수만 처리할 수 있습니다.

다른 작업을 실행하기 위해서 이전 작업이 완료될 때까지 기다려야만 하는 상황을 블로킹(Blocking)이라고 합니다.이를 극복하기 위한 해결 방안은 바로 **비동기 콜qor(Asynchronous Callbacks)** 입니다.

자바스크립트는 브라우저의 Web API나 Node.js의 libuv 등을 이용하여 비동기 작업을 처리합니다.

비동기 작업이 발생하면, 해당 작업은 브라우저의 Web API에 위임됩니다. 예를 들어, `setTimeout`이나 `fetch`와 같은 작업이 수행되면 자바스크립트 엔진은 이 작업들을 Web API에 넘기고 다른 코드 실행을 이어갑니다. Web API에서 비동기 작업이 완료되면, 그 작업은 **태스크 큐**에 들어가 대기합니다.

이후, **이벤트 루프**가 콜 스택이 비어있는지 확인한 뒤 **태스크 큐**에서 대기중인 작업을 콜 스택으로 가져와 실행합니다. 이러한 구조 덕분에 자바스크립트는 싱글 스레드임에도 비동기적으로 작업을 처리하여 다양한 작업을 효율적으로 관리할 수 있습니다.

## 태스크 큐의 종류에는 어떤 것들이 있나요?

크게 **매크로태스크 큐**와 **마이크로태스크 큐**로 나뉩니다. 이들 큐는 비동기 작업의 우선순위를 관리하고, 이벤트 루프가 적절한 시점에 콜백을 실행하기 위해 사용됩니다.

### 매크로태스크 큐

일반적인 비동기 작업의 콜백이 저장되는 큐입니다. `setTimeout`, `setInterval`, I/O 작업, 이벤트 핸들러 등은 작업 완료 후 매크로태스크 큐에 콜백을 대기시킵니다. 매크로태스크 큐는 이벤트 루프의 한 번의 반복마다 하나의 태스크만 처리되므로, UI 업데이트나 다른 작업과 균형있게 진행됩니다.

### 마이크로태스크 큐

더 높은 우선순위가 필요한 비동기 작업들이 대기하는 큐입니다. `Promise.then`, `MutationObserver` 등의 비동기 콜백이 여기에 저장됩니다. 이벤트 루프는 매크로태스크를 실행하기 전에 항상 마이크로 태스크 큐를 먼저 확인하고, 모든 마이크로태스크를 처리한 후 매크로태스크로 넘어갑니다. 이 방식으로 마이크로태스크 큐의 작업은 높은 우선순위로 처리됩니다.

## 몰랐던 것들은 무엇인가요?

### Node.js의 libuv란?

비동기 I/O 작업, 이벤트 처리, 동시성 및 기타 시스템 관련 기능에 대한 크로스 플랫폼 지원을 제공하는 라이브러리입니다. 운영체제들의 커널(운영체제의 핵심부로 컴퓨터 자원들을 관리하는 역할)을 추상화해 다양한 운영 체제에서 일관되게 작동한다.

자바스크립트 엔진은 내부적으로 비동기 처리를 할 수 없기 때문에 비동기로 처리되는 코드를 만날 경우 libuv 라이브러리를 통해 비동기 작업을 처리하게 됩니다.

### 브라우저의 기본 구조는?

> **Heap** : 메모리 할당이 발생하는 곳입니다.

> **Call Stack [LIFO]** : 실행된 코드의 환경을 저장하는 자료 구조로, 함수 호출 시 이곳에 저장됩니다. 함수들을 스택으로 쌓아 가장 마지막에 쌓인 함수를 먼저 처리합니다.

> **Web API** : 브라우저에서 제공하는 어플리케이션 프로그래밍 인터페이스(API)로, DOM, TimeOut 등이 있습니다.<p>
> Call Stack에서 실행된 비동기 함수는 Web API를 호출하고, Web API는 콜백 함수를 태스크 큐에 넣습니다.

> **Callback Queue [FIFO]** : 함수를 저장하는 자료구조로, Call Stack과 다르게 가장 먼저 들어온 함수를 먼저 처리합니다.

> **Event Loop** : Call Stack이 다 비워지면, Callback Queue에 존재하는 함수를 하나씩 Call Stack으로 옮기는 역할을 합니다.
